from netaddr import cidr_merge
from netaddr import iprange_to_cidrs

def main():
    ip_pool = []

    for line in open('ip.txt', 'r', encoding = 'utf-8'):
        ip_start, ip_end, ip_name = line.strip().split(',')

        float_left = lambda _ : _[:-2] + '.0' if _.endswith('.1') else _
        float_right = lambda _ : _[:-4] + '.255' if _.endswith('.254') else _

        ip_pool.extend(iprange_to_cidrs(float_left(ip_start), float_right(ip_end)))

    cidrs = cidr_merge(ip_pool)
    with open('cidrs.txt', 'w') as f:
        for cidr in cidrs:
            f.write(str(cidr))
            f.write('\n')

if __name__ == '__main__':
    main()
